<html>

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.5.9/dist/css/uikit.min.css" />
    <!-- UIkit JS -->
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.5.9/dist/js/uikit-icons.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <style>
        .outer {
            position: absolute;
            /* ★ */
            top: 30%;
            left: 50%;
            /* ★ */
            transform: translateY(-40%);
            transform: translateX(-40%);
        }

        body {
            margin: 0px;
            padding: 0px;
        }
    </style>
</head>

<body>
    <div uk-sticky="media: 960"
        class="uk-navbar-container tm-navbar-container uk-sticky uk-active uk-sticky-below uk-sticky-fixed"
        style="position: fixed; top: 0px; width: 100%;">
        <div class="uk-container uk-container-expand">
            <nav class="uk-navbar">
                <div class="uk-navbar-center"><a href="../" class="uk-navbar-item uk-logo"><img uk-svg=""
                            src="../images/uikit-logo.svg" class="uk-margin-small-right" hidden=""><svg width="28"
                            height="34" viewBox="0 0 28 34" xmlns="http://www.w3.org/2000/svg"
                            class="uk-margin-small-right uk-svg" data-svg="../images/uikit-logo.svg">
                            <polygon fill="#fff" points="19.1,4.1 13.75,1 8.17,4.45 13.6,7.44 "></polygon>
                            <path fill="#fff"
                                d="M21.67,5.43l-5.53,3.34l6.26,3.63v9.52l-8.44,4.76L5.6,21.93v-7.38L0,11.7v13.51l13.75,8.08L28,25.21V9.07 L21.67,5.43z">
                            </path>
                        </svg> UIkit
                    </a>
                </div>
            </nav>
        </div>
    </div>
    <div class="uk-flex outer" id="working" name="working">
        <form>
            <div class="uk-card uk-card-default uk-card-body uk-margin" uk-margin>
                <canvas id="targetCanvas" width="600" height="600"></canvas>


        </form>
    </div>
</body>
<script>
    function loadImages(sources, callback) {
        var images = [];
        var loadedImages = 0;
        var numImages = 0;
        // get num of sources
        for (var src in sources) {
            numImages++;
        }
        for (i = 0; i < sources.length; i++) {
            images[i] = new Image();

            images[i].onload = function () {
                if (++loadedImages >= numImages) {
                    callback(images);
                }
            };
            images[i].src = sources[i];
        }
    }


    var canvas = document.getElementById('targetCanvas');
    var context = canvas.getContext('2d');
    var background = new Image();
        background.src = "https://images.unsplash.com/photo-1601662528567-526cd06f6582?ixlib=rb-1.2.1&auto=format&fit=crop&w=1858&q=80";
        background.onload = function(){
            context.drawImage(background,0,0);   
        }

    var sources = [
        'https://instagram.ftpe4-1.fna.fbcdn.net/v/t51.2885-15/e35/c135.0.810.810a/s320x320/121576002_900343150494746_205971951900198485_n.jpg?_nc_ht=instagram.ftpe4-1.fna.fbcdn.net&_nc_cat=1&_nc_ohc=Z0BDJIhcZIsAX8SExAZ&tp=1&oh=a64a5479780d79d36120ba50296b7c57&oe=5FE6A358',
        'https://instagram.ftpe4-1.fna.fbcdn.net/v/t51.2885-15/e35/c0.180.1440.1440a/s320x320/121591357_532772824347487_4124198607487062284_n.jpg?_nc_ht=instagram.ftpe4-1.fna.fbcdn.net&_nc_cat=1&_nc_ohc=6ydzBqTRpggAX-gFk83&tp=1&oh=74f5c843400e2daea713e7162ee4c3d5&oe=5FE5F791',
        'https://instagram.ftpe4-1.fna.fbcdn.net/v/t51.2885-15/e35/c0.180.1440.1440a/s320x320/122201822_133924374740607_3785423554222840328_n.jpg?_nc_ht=instagram.ftpe4-1.fna.fbcdn.net&_nc_cat=1&_nc_ohc=cgU_zC2cHtwAX_7wkZ7&tp=1&oh=1d1bcf86241e8b9add2c3f548d5561e3&oe=5FE41604',
        'https://instagram.ftpe4-1.fna.fbcdn.net/v/t51.2885-15/e35/c0.180.1440.1440a/s320x320/122717632_208241470663052_5411903066941748735_n.jpg?_nc_ht=instagram.ftpe4-1.fna.fbcdn.net&_nc_cat=1&_nc_ohc=58aDfwH5Ve8AX9p6JZ-&tp=1&oh=62dfbff8cdca6bb189a1f5ac459b8434&oe=5FE39D07',
        'https://instagram.ftpe4-1.fna.fbcdn.net/v/t51.2885-15/e35/c0.180.1440.1440a/s320x320/122921379_147135963791339_6788428230753090992_n.jpg?_nc_ht=instagram.ftpe4-1.fna.fbcdn.net&_nc_cat=1&_nc_ohc=8yZzb3j5vbkAX9hv5mv&tp=1&oh=ed878c10a4d856ab0f7f8a71574334ba&oe=5FE4559F',
        'https://instagram.ftpe4-1.fna.fbcdn.net/v/t51.2885-15/e35/p320x320/121320812_333599767740363_777652534210059767_n.jpg?_nc_ht=instagram.ftpe4-1.fna.fbcdn.net&_nc_cat=1&_nc_ohc=d9b3VR2dGQoAX-iUxsK&tp=1&oh=bbbb587bf0ee06a8632c9165ce5c2738&oe=5FBDB992',
        'https://instagram.ftpe4-1.fna.fbcdn.net/v/t51.2885-15/e35/c68.0.1303.1303a/s320x320/121503329_193482415515401_608154217417396496_n.jpg?_nc_ht=instagram.ftpe4-1.fna.fbcdn.net&_nc_cat=1&_nc_ohc=EinBdjxNsygAX8z8JJu&tp=1&oh=419288e7067bf117adf39f8165e4c5a8&oe=5FE38900',
        'https://instagram.ftpe4-1.fna.fbcdn.net/v/t51.2885-15/e35/c0.170.1440.1440a/s320x320/121640038_200215504951684_5056873300126346118_n.jpg?_nc_ht=instagram.ftpe4-1.fna.fbcdn.net&_nc_cat=1&_nc_ohc=uV8Blr1owJcAX8mAZnv&tp=1&oh=afe8ea166fb57b1af41f430ea8c3d5c9&oe=5FE4EEA6',
        'https://instagram.ftpe4-1.fna.fbcdn.net/v/t51.2885-15/e35/c0.180.1440.1440a/s320x320/121591357_532772824347487_4124198607487062284_n.jpg?_nc_ht=instagram.ftpe4-1.fna.fbcdn.net&_nc_cat=1&_nc_ohc=6ydzBqTRpggAX-gFk83&tp=1&oh=74f5c843400e2daea713e7162ee4c3d5&oe=5FE5F791',
    ];


    function drawRectanlesBorders(img, x, y, width, height, deg) {

        var c = document.getElementById("targetCanvas");
        var ctx = c.getContext("2d");
        var rad = deg * Math.PI / 180;

        ctx.save();
        ctx.translate(x + width / 2, y + height / 2);
        ctx.rotate(rad);
        ctx.beginPath();
        ctx.rect(width / 2 * (-1), height / 2 * (-1), width, height);
        ctx.lineWidth = 5;
        ctx.strokeStyle = 'white';
        ctx.stroke();
        ctx.restore();
    }


    function drawImageRot(img, x, y, width, height, deg) {

        var c = document.getElementById("targetCanvas");
        var ctx = c.getContext("2d");
        var rad = deg * Math.PI / 180;

        ctx.save();
        ctx.translate(x + width / 2, y + height / 2);
        ctx.rotate(rad);
        ctx.drawImage(img, width / 2 * (-1), height / 2 * (-1), width, height);
        ctx.restore();
    }


    loadImages(sources, function (images) {
        var c = document.getElementById("targetCanvas");
        
        rowSize = Math.ceil(Math.sqrt(sources.length));
        console.log(rowSize);
        width = Math.floor(c.height / rowSize);
        height = width;
        padding=3;
        grid_width = width - (rowSize*padding);
        grid_height = grid_width;
        x_padding=padding;
        y_padding=padding;
        for (i = 0; i < sources.length; i++) {
            y = y_padding+ (width * Math.floor(i / rowSize));
            x = x_padding+ (height * (i % rowSize));
            
            
            drawRectanlesBorders(sources[i], x, y, grid_width, grid_height, 0);

            if (images[i].width > images[i].height) {
                img_width = grid_width;
                img_height = Math.floor(images[i].height * (grid_width / images[i].width))
            } else {
                img_height = grid_width;
                img_width = Math.floor(images[i].width * (grid_width / images[i].height))
            }
            console.log(images[i].height, images[i].width, img_height, img_width)
            if (img_width < grid_width) {
                x += (grid_width - img_width) / 2;
            }
            if (img_height < grid_height) {
                y += (grid_height - img_height) / 2;
            }
            drawImageRot(images[i], x, y, img_width, img_height, 0);
        }
    });
</script>

</html>